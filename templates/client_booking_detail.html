{% extends "base.html" %}

{% block content %}
<div class="layout">
    <aside class="sidebar">
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('client_dashboard') }}">
                <span>üè†</span> Home
            </a></li>
            <li><a href="{{ url_for('client_cabins') }}">
                <span>üè°</span> Browse Cabins
            </a></li>
            <li><a href="{{ url_for('client_bookings') }}" class="active">
                <span>üìÖ</span> My Bookings
            </a></li>
            <li><a href="{{ url_for('logout') }}">
                <span>üö™</span> Logout
            </a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div style="margin-bottom: 20px;">
            <a href="{{ url_for('client_bookings') }}" style="color: #6366f1; text-decoration: none; font-size: 14px;">‚Üê Back to My Bookings</a>
        </div>

        <div class="card" style="margin-bottom: 20px;">
            <div style="padding: 25px; background-color: #6366f1; color: white;">
                <h1 style="font-size: 24px; margin-bottom: 5px;">Booking #{{ "%03d"|format(booking['id']) }}</h1>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <span style="background-color: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                        {{ booking['status'].replace('_', ' ').upper() }}
                    </span>
                    <span style="font-size: 14px;">
                        üìÖ {{ booking['num_nights'] }} nights in Cabin {{ booking['cabin_number'] }}
                    </span>
                </div>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h2>Cabin Information</h2>
                </div>
                <div class="card-body">
                    {% if booking['image_url'] %}
                    <img src="{{ booking['image_url'] }}" alt="{{ booking['cabin_name'] }}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 6px; margin-bottom: 15px;">
                    {% endif %}
                    <h3 style="font-size: 20px; margin-bottom: 10px;">{{ booking['cabin_name'] }}</h3>
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 15px;">
                        <div>üè∑Ô∏è Cabin #{{ booking['cabin_number'] }}</div>
                        <div>üë• {{ booking['num_guests'] }} guests</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Booking Details</h2>
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Check-in</strong>
                        <div style="font-size: 16px;">
                            {% set check_in_date = booking['check_in'].split()[0] if ' ' in booking['check_in'] else booking['check_in'] %}
                            {{ check_in_date }}
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Check-out</strong>
                        <div style="font-size: 16px;">
                            {% set check_out_date = booking['check_out'].split()[0] if ' ' in booking['check_out'] else booking['check_out'] %}
                            {{ check_out_date }}
                        </div>
                    </div>

                    {% if booking['observations'] %}
                    <div style="padding: 15px; background-color: #f3f4f6; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; font-size: 13px;">üìù Observations</strong>
                        <div style="font-size: 14px;">{{ booking['observations'] }}</div>
                    </div>
                    {% endif %}
                    
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Breakfast included?</strong>
                        <div>{{ 'Yes' if booking['breakfast_included'] else 'No' }}</div>
                    </div>

                    <div style="padding: 15px; background-color: #fef3c7; border-radius: 6px; margin-top: 20px;">
                        <strong style="display: block; margin-bottom: 10px; font-size: 13px;">üí∞ Total price</strong>
                        <div style="font-size: 22px; font-weight: 700;">
                            ${{ "%.2f"|format(booking['total_price']) }}
                        </div>
                        {% if booking['breakfast_included'] %}
                        <div style="font-size: 13px; color: #92400e; margin-top: 5px;">
                            (${{ "%.2f"|format(booking['price_per_night'] * booking['num_nights']) }} cabin + ${{ "%.2f"|format(booking['total_price'] - (booking['price_per_night'] * booking['num_nights'])) }} breakfast)
                        </div>
                        {% endif %}
                    </div>

                    {% if booking['created_at'] %}
                    <div style="margin-top: 15px; font-size: 13px; color: #6b7280;">
                        Booked on {{ booking['created_at'] }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if booking['status'] == 'checked_out' %}
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h2>Leave a Review</h2>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_review', booking_id=booking['id']) }}">
                    <div class="form-group">
                        <label for="rating">Rating</label>
                        <select id="rating" name="rating" class="form-control" required>
                            <option value="">Select rating</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Very Good</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê Good</option>
                            <option value="2">‚≠ê‚≠ê Fair</option>
                            <option value="1">‚≠ê Poor</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="comment">Your Review</label>
                        <textarea id="comment" name="comment" class="form-control" placeholder="Share your experience..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Submit Review</button>
                </form>
            </div>
        </div>
        {% endif %}

        <div style="margin-top: 20px; display: flex; gap: 10px;">
            {% if booking['status'] == 'unconfirmed' %}
            <form method="POST" action="{{ url_for('cancel_booking', booking_id=booking['id']) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                <button type="submit" class="btn btn-danger">Cancel Booking</button>
            </form>
            {% endif %}
            <a href="{{ url_for('client_bookings') }}" class="btn btn-secondary">Back to Bookings</a>
        </div>
    </main>
</div>
{% endblock %}
