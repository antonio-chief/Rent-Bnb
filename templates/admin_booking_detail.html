{% extends "base.html" %}

{% block content %}
<div class="layout">
    <aside class="sidebar">
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('admin_dashboard') }}">
                <span>üè†</span> Home
            </a></li>
            <li><a href="{{ url_for('admin_bookings') }}" class="active">
                <span>üìÖ</span> Bookings
            </a></li>
            <li><a href="{{ url_for('admin_cabins') }}">
                <span>üè°</span> Cabins
            </a></li>
            <li><a href="{{ url_for('admin_users') }}">
                <span>üë•</span> Users
            </a></li>
            <li><a href="{{ url_for('logout') }}">
                <span>üö™</span> Logout
            </a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div style="margin-bottom: 20px;">
            <a href="{{ url_for('admin_bookings') }}" style="color: #6366f1; text-decoration: none; font-size: 14px;">‚Üê Back</a>
        </div>

        <div class="card" style="margin-bottom: 20px;">
            <div style="padding: 25px; background-color: #6366f1; color: white; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="font-size: 24px; margin-bottom: 5px;">Booking #{{ "%03d"|format(booking['id']) }}</h1>
                    <span style="background-color: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 12px;">
                        {{ booking['status'].replace('_', ' ').upper() }}
                    </span>
                </div>
                <div style="font-size: 14px;">
                    üìÖ {{ booking['num_nights'] }} nights in Cabin {{ booking['cabin_number'] }}<br>
                    {% set check_in_date = booking['check_in'].split()[0] if ' ' in booking['check_in'] else booking['check_in'] %}
                    {% set check_out_date = booking['check_out'].split()[0] if ' ' in booking['check_out'] else booking['check_out'] %}
                    {{ check_in_date }} ‚Üí {{ check_out_date }}
                </div>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h2>Guest Information</h2>
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Name</strong>
                        <div>üáµüáπ {{ booking['guest_name'] }}</div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Email</strong>
                        <div>{{ booking['guest_email'] }}</div>
                    </div>
                    {% if booking['guest_phone'] %}
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Phone</strong>
                        <div>{{ booking['guest_phone'] }}</div>
                    </div>
                    {% endif %}
                    {% if booking['national_id'] %}
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">National ID</strong>
                        <div>{{ booking['national_id'] }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Booking Details</h2>
                </div>
                <div class="card-body">
                    {% if booking['observations'] %}
                    <div style="padding: 15px; background-color: #f3f4f6; border-radius: 6px; margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; font-size: 13px;">üìù Observations</strong>
                        <div style="font-size: 14px;">{{ booking['observations'] }}</div>
                    </div>
                    {% endif %}
                    
                    <div style="margin-bottom: 15px;">
                        <strong style="display: block; margin-bottom: 5px; color: #6b7280; font-size: 13px;">Breakfast included?</strong>
                        <div>{{ 'Yes' if booking['breakfast_included'] else 'No' }}</div>
                    </div>

                    <div style="padding: 15px; background-color: #fef3c7; border-radius: 6px; margin-top: 20px;">
                        <strong style="display: block; margin-bottom: 10px; font-size: 13px;">üí∞ Total price</strong>
                        <div style="font-size: 18px; font-weight: 700;">
                            ${{ "%.2f"|format(booking['total_price']) }}
                            {% if booking['breakfast_included'] %}
                            <span style="font-size: 13px; font-weight: 400; color: #92400e;">
                                (${{ "%.2f"|format(booking['price_per_night'] * booking['num_nights']) }} cabin + ${{ "%.2f"|format(booking['total_price'] - (booking['price_per_night'] * booking['num_nights'])) }} breakfast)
                            </span>
                            {% endif %}
                        </div>
                        {% if booking['status'] == 'unconfirmed' %}
                        <div style="margin-top: 10px; font-size: 13px; color: #92400e;">
                            ‚ö† WILL PAY AT PROPERTY
                        </div>
                        {% endif %}
                    </div>

                    {% if booking['created_at'] %}
                    <div style="margin-top: 15px; font-size: 13px; color: #6b7280;">
                        Booked on {{ booking['created_at'] }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            {% if booking['status'] == 'unconfirmed' %}
            <form method="POST" action="{{ url_for('check_in_booking', booking_id=booking['id']) }}" style="display: inline;">
                <button type="submit" class="btn btn-success">Check in</button>
            </form>
            {% endif %}

            {% if booking['status'] == 'checked_in' %}
            <form method="POST" action="{{ url_for('check_out_booking', booking_id=booking['id']) }}" style="display: inline;">
                <button type="submit" class="btn btn-success">Check out</button>
            </form>
            {% endif %}

            <form method="POST" action="{{ url_for('delete_booking', booking_id=booking['id']) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this booking?');">
                <button type="submit" class="btn btn-danger">Delete booking</button>
            </form>

            <a href="{{ url_for('admin_bookings') }}" class="btn btn-secondary">Back</a>
        </div>
    </main>
</div>
{% endblock %}
